<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirm TMDB ID - {{.Media.DisplayTitle}} - Shelf</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; }
        .back { text-decoration: none; color: #666; margin-bottom: 20px; display: inline-block; }
        h1 { margin-bottom: 10px; }
        .subtitle { color: #666; margin-bottom: 30px; }

        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .comparison-item { border: 1px solid #ddd; border-radius: 5px; padding: 20px; }
        .comparison-item h2 { font-size: 18px; margin-bottom: 15px; color: #666; }
        .media-info { margin-bottom: 20px; }
        .media-info h3 { font-size: 20px; margin-bottom: 10px; }
        .media-meta { color: #666; font-size: 14px; margin-bottom: 5px; }
        .media-poster { width: 100%; max-width: 200px; margin: 15px auto; display: block; border-radius: 5px; }
        .media-placeholder { width: 100%; max-width: 200px; aspect-ratio: 2/3; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 48px; margin: 15px auto; border-radius: 5px; }
        .media-overview { font-size: 14px; line-height: 1.6; color: #333; margin-top: 15px; }
        .genres { margin-top: 15px; }
        .genre { display: inline-block; background: #eee; padding: 5px 10px; margin-right: 5px; margin-bottom: 5px; border-radius: 3px; font-size: 12px; }

        .confirm-section { background: #f5f5f5; padding: 20px; border-radius: 5px; }
        .form-group { margin-bottom: 15px; }
        .checkbox-group { display: flex; align-items: center; }
        .checkbox-group input[type="checkbox"] { margin-right: 10px; width: 18px; height: 18px; cursor: pointer; }
        .checkbox-group label { cursor: pointer; font-size: 14px; }
        .helper-text { font-size: 12px; color: #666; margin-top: 5px; margin-left: 28px; }

        .btn { display: inline-block; padding: 12px 24px; text-decoration: none; border-radius: 5px; font-size: 14px; border: none; cursor: pointer; font-weight: bold; }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-primary:hover { background: #45a049; }
        .btn-secondary { background: #eee; color: #333; margin-left: 10px; }
        .btn-secondary:hover { background: #ddd; }

        .warning-box { background: #fff3cd; border: 1px solid #ffc107; color: #856404; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .warning-box strong { display: block; margin-bottom: 5px; }

        .error { background: #ffebee; color: #c62828; padding: 15px; border-radius: 5px; margin-bottom: 20px; }

        @media (max-width: 768px) {
            .comparison { grid-template-columns: 1fr; }
            .btn { display: block; width: 100%; margin: 5px 0; text-align: center; }
            .btn-secondary { margin-left: 0; }
        }
    </style>
</head>
<body>
    <a href="/media/{{.Media.Slug}}/search-tmdb{{if .Query}}?query={{.Query}}{{end}}" class="back">‚Üê Back to Search</a>

    <h1>Confirm TMDB Match</h1>
    <p class="subtitle">Review and confirm the TMDB match for <strong>{{.Media.DisplayTitle}}</strong></p>

    {{if .Error}}
    <div class="error">{{.Error}}</div>
    {{end}}

    {{if .Media.TMDBID}}
    <div class="warning-box">
        <strong>‚ö†Ô∏è Warning</strong>
        This media item already has a TMDB ID ({{.Media.TMDBID}}). Saving this new ID will replace the existing metadata including poster, description, and genres.
    </div>
    {{end}}

    <div class="comparison">
        <div class="comparison-item">
            <h2>Your Media</h2>
            <div class="media-info">
                <h3>{{.Media.DisplayTitle}}</h3>
                <div class="media-meta">Type: {{.Media.Type}}</div>
                {{if gt .Media.Year 0}}
                <div class="media-meta">Year: {{.Media.Year}}</div>
                {{end}}
                <div class="media-meta">Disks: {{.Media.DiskCount}}</div>
                {{if .Media.TMDBID}}
                <div class="media-meta">Current TMDB ID: {{.Media.TMDBID}}</div>
                {{end}}
            </div>
            {{if .HasPoster}}
            <img src="{{.Media.PosterURL}}" alt="{{.Media.DisplayTitle}}" class="media-poster">
            {{else}}
            <div class="media-placeholder">
                {{if eq .Media.Type 0}}üé¨{{else}}üì∫{{end}}
            </div>
            {{end}}
            {{if .Description}}
            <div class="media-overview">{{.Description}}</div>
            {{end}}
        </div>

        <div class="comparison-item" style="border: 2px solid #4CAF50;">
            <h2>TMDB Match</h2>
            {{if .TMDBMatch}}
            <div class="media-info">
                <h3>{{.TMDBMatch.GetTitle}}</h3>
                <div class="media-meta">TMDB ID: {{.TMDBMatch.ID}}</div>
                {{if .TMDBMatch.GetDate}}
                <div class="media-meta">{{if eq .Media.Type 0}}Release Date{{else}}First Air Date{{end}}: {{.TMDBMatch.GetDate}}</div>
                {{end}}
                {{if .TMDBMatch.Popularity}}
                <div class="media-meta">Popularity: {{printf "%.1f" .TMDBMatch.Popularity}}</div>
                {{end}}
            </div>
            {{if .TMDBMatch.PosterPath}}
            <img src="https://image.tmdb.org/t/p/w300{{.TMDBMatch.PosterPath}}" alt="{{.TMDBMatch.GetTitle}}" class="media-poster">
            {{else}}
            <div class="media-placeholder">
                {{if eq .Media.Type 0}}üé¨{{else}}üì∫{{end}}
            </div>
            {{end}}
            {{if .TMDBMatch.Overview}}
            <div class="media-overview">{{.TMDBMatch.Overview}}</div>
            {{else}}
            <div class="media-overview" style="color: #999;">No overview available</div>
            {{end}}
            {{else}}
            <div class="media-overview" style="color: #999;">Unable to load TMDB match details</div>
            {{end}}
        </div>
    </div>

    <div class="confirm-section">
        <form method="POST" action="/media/{{.Media.Slug}}/set-tmdb">
            <input type="hidden" name="tmdb_id" value="{{.TMDBID}}">
            {{if .Query}}
            <input type="hidden" name="query" value="{{.Query}}">
            {{end}}

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="download_metadata" name="download_metadata" value="true" checked>
                    <label for="download_metadata">Download metadata now (poster, description, genres)</label>
                </div>
                <div class="helper-text">If unchecked, metadata will be downloaded on the next server restart</div>
            </div>

            <button type="submit" class="btn btn-primary">Confirm and Save TMDB ID</button>
            <a href="/media/{{.Media.Slug}}/search-tmdb{{if .Query}}?query={{.Query}}{{end}}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
</body>
</html>
